(*  Geometric Brownian motion SDE  *)

(*//  dS_t = mu*S_t*dt + sigma*S_t*d*W_t  //*)
(* where W_t is a Wiener Process/Brownian Motion *)
(* here we say that:
mu is a percentage drift: i.e how much a particle drifts per unit time
sigma is the percentage volatility: i.e how likely the particle is to make ranom movements per unit time
*)

(* Analytic solution *)
(* solved with an ito integral *)
(*// S_t = S_0 * e^((mu - sigma^2/2) * t + sigma* W_t) //*)

(* Wiener Process/Brownian Motion *)
(* 
   1. W_0 = 0
   2. W has independent increments: for every t > 0, W_(t+u) - W_t, u>=0, are independent of the past values W_s, s <= t
   3. W has gaussian inrements: W_(t+u) - W_t ~ N(0, u)
   4. W has continuos paths: W_t continuous in t
   
   // basically, a wiener process is continuous, randomly distributed with a normal distribution and begins at 0 //
*)

(* Analytic solution becomes ... *)
(* // S_t = S_0 * e^((mu - sigma^2/2) * t + sigma* randomNormal(0, sqrt(t))) // *)
(* translates to: cumulative product of past exponentials *)
mu = 1
s0 = 100
dt = 0.1
sigma = Table[x, {x,0.8,1.8,0.2}]
numOfProcesses = Length[sigma]
sampleSize  = 50
sigSqr = ( mu - Table[sig^2/2,{sig, 0.8,1.8,0.2}])*dt
randNorm =Table[sigma*z, {z,Transpose[Table[RandomVariate[NormalDistribution[0, Sqrt[dt]], sampleSize],numOfProcesses]]}]
exp = Table[Exp[x],{x,Table[sigSqr + y, {y, randNorm}]}]
preProcess = Prepend[exp, Table[1, numOfProcesses]]
cumulativeProd = Table[s0*x,{x,Rest[FoldList[Times, 1, preProcess0]]}]
patterns = Transpose[cumulativeProd]

ListLinePlot[patterns]

(* condensed expression for geometric brownian motion *)

geoBM = Transpose[Table[100*x,{x,Rest[FoldList[Times, 1, Prepend[Table[Exp[x],{x,Table[( 1 - Table[sig^2/2,{sig, 0.8,1.8,0.2}])*0.1 + y, {y, Table[Table[x, {x,0.8,1.8,0.2}]*z, {z,Transpose[Table[RandomVariate[NormalDistribution[0, Sqrt[dt]], 50], Length[Table[x, {x,0.8,1.8,0.2}]]]]}]}]}], Table[1,  Length[Table[x, {x,0.8,1.8,0.2}]]]]]]}]]
ListLinePlot[geoBM]

(* we can now manipulate the arguments and form an interactive visualisation of changes in the motion of the particle in question *)

Manipulate[
ListLinePlot[Transpose[Table[s0*x,{x,Rest[FoldList[Times, 1, Prepend[Table[Exp[x],{x,Table[( mu - Table[sig^2/2,{sig, 0.8,1.8,0.2}])*dt + y, {y, Table[Table[x, {x,0.8,1.8,0.2}]*z, {z,Transpose[Table[RandomVariate[NormalDistribution[0, Sqrt[dt]], 50], Length[Table[x, {x,0.8,1.8,0.2}]]]]}]}]}], Table[1,  Length[Table[x, {x,0.8,1.8,0.2}]]]]]]}]]],
{mu,1,5,1 },
{s0,100,150,10},
{dt,0.1,1,0.05}
]
